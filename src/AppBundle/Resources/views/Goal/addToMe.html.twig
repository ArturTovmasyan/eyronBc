<div class="modal" id="goal-modal" data-ng-controller="goalEnd">
    <div class="goal-container">
        <div data-ng-if="newAdded" class="email">{{ "goal.create_goal" | trans }}</div>

        <div class="modal-top">
            <figure data-ng-if="userGoal.goal.cached_image">
                <img data-ng-if="userGoal.goal.cached_image" data-ng-src="[[ userGoal.goal.cached_image]]" alt="[[ userGoal.goal.title ]]" class="img-responsive"/>
            </figure>

            <span class="overlay"></span>

            <div>
                <h2 data-ng-class="{'title-smaller': userGoal.goal.title.length > 35, 'title-top': !userGoal.goal.author.show_name}">
                    <span>[[ userGoal.goal.title ]]</span>
                </h2>
                {% if app.user %}
                    <p data-ng-if="userGoal.goal.author && !userGoal.goal.author.is_admin && userGoal.goal.author.id == {{ app.user.id }}">
                        [[ userGoal.goal.author.show_name ]]
                    </p>
                {% endif %}
                <ul>
                    <li>
                        <a href="javascript:void(0)">
                            {{ 'block_listed'|trans | capitalize }}
                            <span>[[ userGoal.goal.stats.listedBy | number ]]</span>
                            <i class="icon-user-small"></i>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)">
                            {{ 'block_completed'|trans | capitalize }}
                            <span>[[ userGoal.goal.stats.doneBy | number ]]</span>
                            <i class="icon-user-small"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        {% set arrayMonth = {
        0:'form.birth_date_month'|trans({}, 'FOSUserBundle'),
        1:'form.month_january'|trans({}, 'FOSUserBundle'),
        2:'form.month_february'|trans({}, 'FOSUserBundle'),
        3:'form.month_march'|trans({}, 'FOSUserBundle'),
        4:'form.month_april'|trans({}, 'FOSUserBundle'),
        5:'form.month_may'|trans({}, 'FOSUserBundle'),
        6:'form.month_june'|trans({}, 'FOSUserBundle'),
        7:'form.month_july'|trans({}, 'FOSUserBundle'),
        8:'form.month_august'|trans({}, 'FOSUserBundle'),
        9:'form.month_september'|trans({}, 'FOSUserBundle'),
        10:'form.month_october'|trans({}, 'FOSUserBundle'),
        11:'form.month_november'|trans({}, 'FOSUserBundle'),
        12:'form.month_december'|trans({}, 'FOSUserBundle') }
        %}

        <form class="form-horizontal" method="post" data-ng-init="myMonths={{ arrayMonth |json_encode()}}; redirectPath='{{ path('user_profile') }}'">
            <div class="goal-end">
                {# edit goal status #}
                <div class="clearfix ng-hide" data-ng-show="userGoal.id"
                     data-ng-init="defaultYear = '{{ 'form.birth_date_year'|trans({}, 'FOSUserBundle') }}';
                                    defaultDay = '{{ 'form.birth_date_day'|trans({}, 'FOSUserBundle') }}';
                                    defaultMonth = '{{ 'form.birth_date_month'|trans({}, 'FOSUserBundle') }}'">
                    <div class="form-group row no-marginb">

                        <h3 class="control-label text-left">
                            {#<span data-ng-show="complete.switch">{{ "goal.is_completed"|trans }}</span>#}
                            {#<span data-ng-hide="complete.switch">{{ "goal.is_active"|trans }}</span>#}
                            Goal Status
                        </h3>
                        <div class="row form-group no-marginb ng-hide" data-ng-show="userGoal.id">
                            <label class="col-sm-12 control-label text-left">
                                <span data-ng-show="complete.switch == 1" class="small-size">{{ "goal.completed_text"|trans }}</span>
                                <span data-ng-hide="complete.switch == 1" class="small-size">{{ "goal.active_text"|trans }}</span>
                            </label>
                        </div>

                        <div>
                            <div data-ng-init="complete.switch=(userGoal.status==UserGoalConstant['ACTIVE']? 0:1)">
                                <md-radio-group data-ng-model="complete.switch" name="goal_status">

                                    <md-radio-button value="0" class="md-primary">Active</md-radio-button>
                                    <md-radio-button value="1" class="md-primary"> Completed </md-radio-button>

                                </md-radio-group>
                            </div>
                        </div>
                    </div>

                </div>

                <hr/>

                <h3 data-ng-class="{'text-purple': !(complete.switch == 1) && userGoal.id && userGoal.do_date && compareDates(firefox_do_date) == -1}" class="ng-hide" data-ng-show="!(complete.switch == 1) || userGoal.do_date">
                    {{ "goal.deadline"|trans }}
                    <i data-ng-show="!(complete.switch == 1) && userGoal.id && userGoal.do_date && compareDates(firefox_do_date) == -1" class="icon-info text-purple"></i>
                    <h6 class="text-gray text-left"
                        data-ng-show="!(complete.switch == 1) && userGoal.id && userGoal.do_date && compareDates(firefox_do_date) == -1">
                        {{ "goal.missed_deadline"|trans }}
                    </h6>
                    <h6 data-ng-hide="userGoal.do_date || userGoal.completion_date || complete.switch == 1"
                        class="text-left text-gray">
                        {{ "dream"|trans }}
                    </h6>
                    <span class="text-purple ng-hide" data-ng-show="complete.switch == 1 && firefox_do_date && (!userGoal.do_date_status || userGoal.do_date_status == 1)">: [[ momentDateFormat(firefox_do_date, 'DD MMM YYYY') ]]</span>
                    <span class="text-purple ng-hide" data-ng-show="complete.switch == 1 && firefox_do_date && (userGoal.do_date_status && userGoal.do_date_status == 2)">: [[ momentDateFormat(firefox_do_date, 'YYYY') ]]</span>
                    <span class="text-purple ng-hide" data-ng-show="complete.switch == 1 && firefox_do_date && (userGoal.do_date_status && userGoal.do_date_status == 3)">: [[ momentDateFormat(firefox_do_date, 'MMM YYYY') ]]</span>
                </h3>
                <h3 class="ng-hide" data-ng-show="complete.switch == 1">{{ "completed"|trans }}</h3>

                <div data-ng-cloak class="form-group row" >

                    <div class="col-sm-4 date ng-hide" data-ng-show="!(complete.switch == 1)">
                        <ui-select search-enabled="false" data-ng-model="$parent.year" skip-focusser="true">
                            <ui-select-match placeholder="{{ 'form.birth_date_year'|trans({}, 'FOSUserBundle') }}">
                                <span>[[ $select.selected ]]</span>
                            </ui-select-match>

                            <ui-select-choices repeat="y in years">
                                <span data-ng-bind="y"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-sm-4 ng-hide" data-ng-show="complete.switch == 1">
                        <ui-select search-enabled="false" data-ng-model="$parent.year" skip-focusser="true">
                            <ui-select-match placeholder="{{ 'form.birth_date_year'|trans({}, 'FOSUserBundle') }}">
                                <span>[[ $select.selected ]]</span>
                            </ui-select-match>

                            <ui-select-choices repeat="y in completeYears">
                                <span data-ng-bind="y"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>

                    <div class="col-sm-4 date ng-hide" data-ng-show="complete.switch == 1">
                        <ui-select search-enabled="false" data-ng-model="$parent.month" skip-focusser="true">
                            <ui-select-match placeholder="{{ 'form.birth_date_month'|trans({}, 'FOSUserBundle') }}">
                                <span>[[ $select.selected ]]</span>
                            </ui-select-match>

                            <ui-select-choices repeat="m in months">
                                <span data-ng-bind="m"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-sm-4 date ng-hide" data-ng-show="!(complete.switch == 1)">
                        <ui-select search-enabled="false" data-ng-model="$parent.month" skip-focusser="true">
                            <ui-select-match placeholder="{{ 'form.birth_date_month'|trans({}, 'FOSUserBundle') }}">
                                <span>[[ $select.selected ]]</span>
                            </ui-select-match>

                            <ui-select-choices repeat="m in months">
                                <span data-ng-bind="m"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-sm-4 date ng-hide" data-ng-show="complete.switch == 1">
                        <ui-select search-enabled="false" data-ng-model="$parent.day" skip-focusser="true">
                            <ui-select-match placeholder="{{ 'form.birth_date_day'|trans({}, 'FOSUserBundle') }}">
                                <span>[[ $select.selected ]]</span>
                            </ui-select-match>

                            <ui-select-choices repeat="day in days">
                                <span data-ng-bind="day"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-sm-4 date ng-hide" data-ng-show="!(complete.switch == 1)">
                        <ui-select search-enabled="false" data-ng-model="$parent.day" skip-focusser="true">
                            <ui-select-match placeholder="{{ 'form.birth_date_day'|trans({}, 'FOSUserBundle') }}">
                                <span>[[ $select.selected ]]</span>
                            </ui-select-match>

                            <ui-select-choices repeat="day in days">
                                <span data-ng-bind="day"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>

                <div class="form-group row" data-ng-if="userGoal.goal.location">
                    <div class="col-sm-12">
                        <div class="location">
                            <i class="icon-location-icon"></i>
                            <input type="text"
                                data-ng-disabled="true"
                                data-ng-model="userGoal.goal.location.address"
                                class="form-control place-autocomplete"
                                placeholder="{{ "goal.location_ex"|trans }}"/>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-12">
                        <i class="icon-pencil"></i>
                        <textarea class="form-control"
                          data-ng-model="userGoal.note"
                          rows="3"
                          placeholder="{{ 'goal.note_p'|trans }}"></textarea>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-xs-12">
                        {#<h3 class="ng-hide" data-ng-show="!complete.switch">{{ 'goal.as_priority'|trans() }} </h3>#}
                        <h3 class="ng-hide" data-ng-show="!(complete.switch == 1)">Priority</h3>
                        {#<h3 class="ng-hide" data-ng-show="complete.switch">#}
                            {#{{ 'goal.priority'|trans() }}: {% for id, name in filters %}#}
                            {#<strong class="text-purple priority-types ng-hide" data-ng-show="getPriority(userGoal)=={{ id }}">#}
                                {#{{ name | trans | raw }}#}
                            {#</strong>#}
                            {#{% endfor %}#}
                        {#</h3>#}

                        <div class="priority ng-hide" data-ng-show="!(complete.switch == 1)">
                            <div class="row no-gutter">
                                {#<div class="col-xs-1">#}
                                    {#<h5 class="text-gray hidden-xs">{{ 'goal.importance'|trans }}</h5>#}
                                {#</div>#}
                                <md-checkbox aria-label="Urgent" calss="md-primary" data-ng-model="userGoal.urgent">
                                    {{ 'goal.urgent'|trans }}
                                </md-checkbox>
                                <md-checkbox aria-label="Important" calss="md-primary" data-ng-model="userGoal.important">
                                    {{ 'goal.important'|trans }}
                                </md-checkbox>
                                {#<div class="col-xs-11">#}
                                    {#<div class="row dotted">#}
                                        {#<div class="col-sm-1">#}
                                            {#<h6 class="text-gray hidden-xs">#}
                                                {#<span>{{ 'goal.important'|trans }}</span>#}
                                                {#<span>{{ 'goal.not_important'|trans }}</span>#}
                                            {#</h6>#}
                                        {#</div>#}
                                        {#<div class="col-sm-11">#}
                                            {#<div class="row">#}

                                                {# other filters #}
                                                {#{% for id, name in filters %}#}

                                                    {#<div class="col-sm-6">#}
                                                        {#<div class="inputs-style priority-radio"#}
                                                             {#data-ng-class="{'active-important': getPriority(userGoal)=={{ id }}}">#}
                                                            {#<label class="radio-inline">#}
                                                                {#<input name="test"#}
                                                                   {#class="important-radio"#}
                                                                   {#type="radio"#}
                                                                   {#data-ng-model="userGoal.priority"#}
                                                                   {#data-ng-disabled="complete.switch"#}
                                                                   {#data-ng-checked="getPriority(userGoal)=={{ id }}"#}
                                                                   {#value="{{ id }}">#}
                                                                {#{{ name|trans|raw }}#}
                                                            {#</label>#}

                                                            {#<p class="text-gray">#}
                                                                {#{% if id == 1 %}#}
                                                                    {#{{ 'goal.critical_activities'|trans }}#}
                                                                {#{% elseif id == 2 %}#}
                                                                    {#{{ 'goal.avoid_interruptions'|trans }}#}
                                                                {#{% elseif id == 3 %}#}
                                                                    {#{{ 'goal.focus_goal'|trans }}#}
                                                                {#{% elseif id == 4 %}#}
                                                                    {#{{ 'goal.avoid_distractions'|trans }}#}
                                                                {#{% endif %}#}
                                                            {#</p>#}
                                                        {#</div>#}
                                                    {#</div>#}
                                                {#{% endfor %}#}

                                            {#</div>#}
                                            {#<div class="row hidden-xs">#}
                                                {#<div class="col-sm-6 text-center text-gray">#}
                                                    {#<bdi>{{ 'goal.not_urgent'|trans }}</bdi>#}
                                                {#</div>#}
                                                {#<div class="col-sm-6 text-center text-gray">#}
                                                    {#<bdi>{{ 'goal.urgent'|trans }}</bdi>#}
                                                {#</div>#}
                                            {#</div>#}
                                        {#</div>#}
                                    {#</div>#}
                                {#</div>#}

                            </div>
                            {#<p class="text-center text-dark-gray hidden-xs">{{ 'goal.urgency'|trans }}</p>#}
                        </div>

                    </div>
                </div>

                <h4 class="ng-hide" data-ng-show="!(complete.switch == 1)">{{ "goal.complete_step"|trans }}</h4>

                <h3 class="ng-hide" data-ng-show="complete.switch == 1">{{ "goal.steps"|trans }}</h3>

                <div class="progress ng-hide" data-ng-show="!(complete.switch == 1)">
                    <div class="progress-bar progress-bar-striped"
                         role="progressbar"
                         aria-valuenow="45"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         style="width:[[ getCompleted(userGoal) | number:1 ]]%">
                        [[ getCompleted(userGoal) | number:1 ]]% Complete
                    </div>
                </div>

                <div data-dnd-list="userGoal.formatted_steps"
                     data-dnd-disable-if="complete.switch == 1"
                     data-dnd-dragover="dragoverCallback(event, index, external, type)"
                     data-dnd-drop="dropCallback(event, index, item, external, type, '')">
                    <div class="form-group row"
                         data-ng-repeat="(k, step) in userGoal.formatted_steps"
                         data-ng-show="!step.switch"
                         data-dnd-draggable="step"
                         data-dnd-disable-if="!step.text"
                         data-dnd-moved="moveElement($index)"
                         data-dnd-effect-allowed="move"
                         data-dnd-selected="models.selected = step"
                         data-ng-class="{'selected': models.selected === step, 'noselect': !step.text}">
                        {#<label class="col-sm-2 control-label handle" data-ng-show="!(complete.switch == 1)">#}
                            {#<span data-ng-show="step.switch" class="text-purple">{{ "goal.done"|trans }}</span>#}
                            {#<span data-ng-hide="step.switch">{{ "goal.to_do"|trans }}</span>#}
                        {#</label>#}

                        <div class="col-xs-4 col-sm-2">
                            <md-checkbox id="myonoffswitch[[k]]"
                                         aria-label="steps"
                                         name="{% if app.environment !='test'%}switch[ [[k]] ]{% endif %}"
                                         calss="md-primary"
                                         data-ng-model="step.switch"
                                         data-ng-disabled="complete.switch == 1 || !step.text">
                            </md-checkbox>
                            {#<div class="onoffswitch">#}
                            {#class="onoffswitch-checkbox"#}

                            {#<label class="onoffswitch-label" for="myonoffswitch[[k]]">#}
                            {#<span class="onoffswitch-inner"></span>#}
                            {#<span class="onoffswitch-switch"></span>#}
                            {#</label>#}
                            {#</div>#}
                        </div>

                        <div data-ng-class="{'col-xs-12': complete.switch == 1,'col-xs-8 col-sm-8': !(complete.switch == 1)}">
                            <div class="to-do-list">
                                <i title="Notes" class="icon-step-list"></i>
                                <input type="text"
                                       class="form-control"
                                       data-step
                                       data-key="k"
                                       data-array="userGoal.formatted_steps"
                                       data-ng-model="step.text"
                                       data-ng-disabled="complete.switch == 1"
                                       name="{% if app.environment !='test'%}stepText[ [[ k ]] ]{% endif %}"
                                       placeholder="{{ "goal.add_step"|trans }}">
                            </div>
                        </div>

                    </div>
                    <div data-ng-click="completedStepsShow = !completedStepsShow" data-ng-show="completedStepCount">Hide [[ completedStepCount]] Completed</div>
                    <div class="form-group row"
                         data-ng-repeat="(k, step) in userGoal.formatted_steps | filter: {switch: true}"
                         data-ng-show="completedStepsShow">

                        <div class="col-xs-4 col-sm-2">
                            <md-checkbox id="myonoffswitch[[k]]"
                                         aria-label="steps"
                                         name="{% if app.environment !='test'%}switch[ [[k]] ]{% endif %}"
                                         calss="md-primary"
                                         data-ng-model="step.switch"
                                         data-ng-disabled="complete.switch == 1 || !step.text">
                            </md-checkbox>
                        </div>

                        <div data-ng-class="{'col-xs-12': complete.switch == 1,'col-xs-8 col-sm-8': !(complete.switch == 1)}">
                            <div class="to-do-list">
                                <i title="Notes" class="icon-step-list"></i>
                                <input type="text"
                                       class="form-control"
                                       data-step
                                       data-key="k"
                                       data-array="userGoal.formatted_steps"
                                       data-ng-model="step.text"
                                       data-ng-disabled="complete.switch == 1"
                                       name="{% if app.environment !='test'%}stepText[ [[ k ]] ]{% endif %}"
                                       placeholder="{{ "goal.add_step"|trans }}">
                            </div>
                        </div>

                    </div>
                    <div class="dndPlaceholder form-group row">
                    </div>
                </div>

                <hr />

                <div class="form-group row no-marginb">

                    <h3 class="control-label text-left">
                        {{ "goal.visible"|trans }}
                    </h3>

                    {#<div class="col-xs-4 col-sm-2">#}
                        {#<div class="onoffswitch">#}
                                {#class="onoffswitch-checkbox">#}

                            {#<label class="onoffswitch-label" for="goal-is-visible">#}
                                {#<span class="onoffswitch-inner"></span>#}
                                {#<span class="onoffswitch-switch"></span>#}
                            {#</label>#}
                        {#</div>#}
                    {#</div>#}
                    <p class="text-gray">
                        <i class="icon-eye-icon ng-hide" data-ng-hide="userGoal.is_visible"></i>
                        <i class="icon-eye" data-ng-show="userGoal.is_visible"></i>
                        <span data-ng-hide="userGoal.is_visible" style="padding-top:5px;">{{ "goal.visible_text"|trans }}</span>
                        <span data-ng-show="userGoal.is_visible">{{ "goal.invisible_text"|trans }}</span>
                    </p>

                    <div>
                        <md-radio-group data-ng-model="userGoal.is_visible" id="goal-is-visible">

                            <md-radio-button data-ng-value="true" class="md-primary">Visible</md-radio-button>
                            <md-radio-button data-ng-value="false" class="md-primary"> Invisible </md-radio-button>

                        </md-radio-group>
                    </div>

                </div>

                {% if app.user %}
                    <div data-ng-if="userGoal.id && userGoal.goal.author && userGoal.goal.author.id == {{ app.user.id }} && userGoal.goal.status == GoalConstant['PRIVATE_PRIVACY']">
                        <hr />
                        <p class="text-gray clearfix">
                            <strong class="text-dark-gray pull-left">
                                <i class="icon-lock-white"></i>
                                <span>{{ 'user_goal.private' |trans }}</span>
                            </strong> &nbsp;
                            <span class="text-right pull-right">{{ 'goal.private_text'|trans }}</span>

                        </p>
                        <br />
                    </div>
                {% endif %}

                <p class="text-center error-message" data-ng-if="invalidYear">{{ 'success_story.error_day_in_month1'|trans }} [[ dayInMonth]] {{ 'success_story.error_day_in_month2'|trans }}</p>
                <p class="text-center error-message" data-ng-if="uncompletedYear">{{ 'success_story.error_uncomplete_year'|trans }}</p>
                <div class="modal-bottom">
                    <a  href="javascript:void(0)" data-ng-click="save()" class="btn btn-purple">{{ "btn_save"|trans }}</a>
                    <a href="javascript:void(0)" rel="modal:close" id="cancel" class="btn btn-transparent">{{ 'btn_cancel'|trans }}</a>
                    <a href="javascript:void(0)" data-ng-click="showDetails = ! showDetails" class="btn btn-transparent forget">
                        <i class="icon-trash"></i>
                        <span>{{ 'forget'|trans | upper }}</span>
                    </a>
                </div>

                <div data-ng-show="showDetails">
                    <div class="delete-message">
                        <div>
                            <h3>{{ 'delete_message'|trans|upper|raw }}</h3>
                            <a href="javascript:void(0)" data-ng-click="removeUserGoal(userGoal.id)" class="btn btn-transparent">{{ 'btn_delete'|trans | upper }}</a>
                            <a data-ng-click="showDetails=!showDetails" href="javascript:void(0)" class="btn btn-purple">{{ 'btn_cancel'|trans | upper }}</a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

