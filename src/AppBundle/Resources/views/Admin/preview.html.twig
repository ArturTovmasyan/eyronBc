{% extends '::base.html.twig' %}

{% use 'SonataAdminBundle:CRUD:base_edit_form.html.twig' with form as parentForm %}
{% import 'SonataAdminBundle:CRUD:base_edit_form_macro.html.twig' as form_helper %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets output='css/blog_preview.css'
    'bundles/app/less/amp.less'
    filter='less,cssrewrite' %}
    <link rel="stylesheet" type="text/css" media="screen" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock %}

{% block content %}

    {% set blog = object %}
    {% set blogData = blog.data %}

    <div class="header">
        <h1 class="text-white">{{ blog.title }}</h1>
        <figure>
            <span class="overlay"></span>
            <img src="{{ blog.imagePath|blImageFilter('user_cover') }}" alt="{{ blog.title }}" width="100%">
        </figure>
    </div>

    <div class="bg-white content-inner">
        <figure class="goal-cover">
            <img src="{{ blog.imagePath|blImageFilter('goal_bg') }}">
        </figure>

        {% if blogData|length > 0 %}

            {% for data in blogData %}

                {% if data.type == 'text' %}

                    <p>{{ data.content|markdown|striptags }}</p>

                {% elseif data.type == 'goal' and data.goals is defined %}

                    {% set goal = data.goals %}

                    <div class="goals-information">
                        <figure>
                            <a href="{{ path('inner_goal', {'slug' : goal.slug}) }}" target="_blank">
                                <img src="{{ goal.imagePath|blImageFilter('goal_list_small') }}"
                                    alt="{{ goal.title }}">
                            </a>
                        </figure>

                        <div>
                            <h3 class="text-blue">{{ goal.title }}</h3>
                            {% if goal.description %}
                                <p class="text-blue">{{ goal.description|markdown|striptags|sliceString }}</p>
                            {% endif %}
                        </div>
                    </div>

                {% endif %}
            {% endfor %}
        {% endif %}
    </div>

    {#{{ render_esi(controller('AppBundle:Goal:randomGoal')) }}#}

    <div class="sonata-preview-form-container">
        {{ block('parentForm') }}
    </div>
{% endblock %}

  {% block formactions %}
      {{ include('AppBundle:Admin:preview_buttons.html.twig') }}
  {% endblock %}