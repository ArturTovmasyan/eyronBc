{% extends "AppBundle::layout.html.twig" %}

{% block angularApp %}
<html data-ng-app="goal" data-ng-controller="ActivityController" xmlns="http://www.w3.org/1999/xhtml"> {% endblock %}

{% block stylesheets %}
    {{ parent() }}

    {#<link href="{{ asset('app/bower_components/icheck/skins/all.css') }}" rel="stylesheet">#}
    {% stylesheets output='css/layout_activity.css'
    'app/bower_components/swiper/dist/css/swiper.min.css'
    filter='less,cssrewrite'
    %}
    <link rel="stylesheet" type="text/css" media="screen" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock %}

{% block content %}
    {{ parent() }}

    <div id="news-feed">
        <div class="container">
            <div class="row">

                {% block test  %}

                <div class="new-activity ng-hide" data-ng-show="newActivity" data-ng-cloak>
                   <a href="javascript:void(0)" data-ng-click="addNew()">{{ 'new_activity'|trans({},'newsFeed') }}</a>
                </div>

                <div class="col-md-8" id="activities" data-ng-init="userId='{{ app.user.id }}'">

                        <h3 class="text-dark-gray ng-hide" data-ng-show="showNoActivities" id="non-activity" data-ng-cloak>{{ 'active.not_have'|trans }}
                            <a href="{{ path('goals_list') }}" class="text-purple">adding</a>
                        </h3>

                    <div class="goals-animate"
                         data-ng-cloak
                         {#data-ng-class="{'padding-no': !activity.comment && !activity.success_story}"#}
                         data-ng-repeat="activity in Activities.items"
                         data-ng-init="activity.activeIndex = 1">

                        <div data-ng-show="activity.comment || activity.success_story">
                            {{ _self.goal(env_prefix) }}
                        </div>

                        <div data-ng-class="{'line': activity.comment || activity.success_story}"></div>

                        <div class="bg-white" data-ng-class="{'rounded-corners-bottom': activity.comment || activity.success_story, 'round': !activity.comment && !activity.success_story}">
                            <div class="padding" data-ng-class="{'padding-no': !activity.comment && !activity.success_story}">
                                <div class="clearfix relative">

                                    <figure class="image img-circle">

                                        {% set className = "user-no" ~ random(4) %}

                                        <img data-ng-if="activity.user.cached_image" data-ng-src="[[ ::activity.user.cached_image]]" alt="{{ user.filename }}" class="img-circle img-responsive">
                                        <p data-ng-if="!activity.user.cached_image" class="no-image {% if className is defined %}{{ className }}{% endif %}">
                                            [[ ::activity.user.first_name|limitTo:1|uppercase ]][[ ::activity.user.last_name|limitTo:1|uppercase ]]
                                        </p>
                                    </figure>

                                    <div class="pull-left text-gray">
                                        <h4>

                                            <a data-ng-href="{{ env_prefix  }}/profile/[[ ::activity.user.u_id ]]" class="text-dark-gray">
                                                [[ ::activity.user.first_name ]] [[ ::activity.user.last_name ]]
                                            </a>

                                            <span class="text-gray" data-ng-if="activity.action=={{ constant('AppBundle\\Entity\\NewFeed::GOAL_CREATE') }}">
                                                <span data-ng-if="activity.goals.length < 2">{{ 'goal.create'|trans({},'newsFeed') }}</span>
                                                <span data-ng-if="activity.goals.length > 1">{{ 'goal.create_goals'|trans({},'newsFeed') }} [[ ::activity.goals.length ]] {{ 'goal.goals'|trans({},'newsFeed') }}</span>
                                            </span>

                                             <span class="text-gray" data-ng-if="activity.action=={{ constant('AppBundle\\Entity\\NewFeed::GOAL_ADD') }}">
                                                <span data-ng-if="activity.goals.length < 2">{{ 'goal.add'|trans({},'newsFeed') }}</span>
                                                <span data-ng-if="activity.goals.length > 1">{{ 'goal.add_goals'|trans({},'newsFeed') }} [[ ::activity.goals.length ]] {{ 'goal.goals'|trans({},'newsFeed') }}</span>
                                             </span>

                                             <span class="text-gray" data-ng-if="activity.action=={{ constant('AppBundle\\Entity\\NewFeed::GOAL_COMPLETE') }}">
                                                <span data-ng-if="activity.goals.length < 2">{{ 'goal.complete'|trans({},'newsFeed') }}</span>
                                                <span data-ng-if="activity.goals.length > 1">{{ 'goal.complete_goals'|trans({},'newsFeed') }} [[ ::activity.goals.length ]] {{ 'goal.goals'|trans({},'newsFeed') }}</span>
                                             </span>

                                             <span class="text-gray" data-ng-if="activity.action=={{ constant('AppBundle\\Entity\\NewFeed::SUCCESS_STORY') }}">
                                                {{ 'goal.success_story'|trans({},'newsFeed') }}
                                             </span>

                                             <span class="text-gray" data-ng-if="activity.action=={{ constant('AppBundle\\Entity\\NewFeed::COMMENT') }}">
                                                {{ 'goal.comment'|trans({},'newsFeed') }}
                                             </span>

                                        </h4>

                                        <p>[[ ::activity.datetime | date:'dd MMMM,  yyyy' ]] at [[ ::activity.datetime | date:'HH:mm' ]]</p>

                                    </div>
                                    <div class="pull-right" data-ng-show="activity.goals.length > 1">
                                        <div class="swiper-pagination text-dark-grey">[[ activity.activeIndex ]] / [[ activity.goals.length ]]</div>
                                    </div>
                                </div>

                                <div class="comment-place ng-hide" data-ng-show="activity.comment">
                                    <span class="arrow-up"></span>
                                    [[ ::activity.comment.comment_body ]]
                                </div>

                                <div class="comment-place ng-hide" data-ng-show="activity.success_story">
                                    <span class="arrow-up"></span>
                                    [[ ::activity.success_story.story ]]
                                </div>

                            </div>

                            <div data-ng-show="!activity.comment && !activity.success_story" data-index="[[ $index ]]" class="activity-slider swiper-container">
                                <div class="idea-item swiper-wrapper goals-animate">
                                    <div class="swiper-slide"
                                         data-ng-cloak
                                         data-ng-repeat="singleGoal in activity.reserveGoals">

                                        <figure class="rounded-corners-bottom">

                                            <h3>
                                                <a data-ng-href="[[ singleGoal.publish? '{{ env_prefix }}/goal/' + singleGoal.slug : '#' ]]">[[ singleGoal.title ]]</a>
                                            </h3>

                                            <a data-ng-href="[[ singleGoal.publish? '{{ env_prefix }}/goal/' + singleGoal.slug : '#' ]]"
                                               class="goalTitle">
                                                <span class="overlay"></span>
                                                <img
                                                    data-ng-src="[[ singleGoal.cached_image ]]"
                                                    alt="[[ singleGoal.title ]]"
                                                    data-ng-if="singleGoal.cached_image"/>
                                            </a>

                                            <div class="absolute" data-ng-show="singleGoal.stats.listedBy">
                                                <ul>
                                                    <li>
                                                        <a ls-goal-users
                                                           href="javascript:void(0)"
                                                           ls-goal-id="[[ singleGoal.id ]]"
                                                           ls-category="listed"
                                                           ls-count="[[ ::singleGoal.stats.listedBy ]]"
                                                           data-ng-show="castInt(singleGoal.stats.listedBy)">
                                                            <span>
                                                                {{ 'home_listed_by'|trans({},'messages') | capitalize }}
                                                                [[ singleGoal.stats.listedBy ]]
                                                            </span>
                                                            <i class="icon-user-small"></i>
                                                        </a>
                                                        <span class="text-white" data-ng-hide="castInt(singleGoal.stats.listedBy)">
                                                            {{ 'home_listed_by'|trans({},'messages') }}
                                                            [[ ::singleGoal.stats.listedBy ]]
                                                        </span>
                                                        <i class="icon-user-small" data-ng-hide="castInt(singleGoal.stats.listedBy)"></i>
                                                    </li>
                                                    <li>
                                                        <a ls-goal-users
                                                           href="javascript:void(0)"
                                                           ls-goal-id="[[ singleGoal.id ]]"
                                                           ls-count="[[ ::singleGoal.stats.doneBy ]]"
                                                           data-ng-show="castInt(singleGoal.stats.doneBy)">
                                                            <span>
                                                                {{ 'home_complete'|trans({},'messages') | capitalize }}
                                                                [[ singleGoal.stats.doneBy ]]
                                                            </span>
                                                            <i class="icon-user-small"></i>
                                                        </a>
                                                        <span class="text-white" data-ng-hide="castInt(singleGoal.stats.doneBy)">
                                                            {{ 'home_complete'|trans({},'messages') }}
                                                            [[ ::singleGoal.stats.doneBy ]]
                                                        </span>
                                                        <i class="icon-user-small" data-ng-hide="castInt(singleGoal.stats.doneBy)"></i>
                                                    </li>
                                                </ul>
                                            </div>

                                            <figcaption>
                                                {%  include "AppBundle:Blocks:newsFeedGoalFooter.html.twig"  %}
                                            </figcaption>
                                        </figure>
                                    </div>
                                </div>

                                <div data-ng-show="activity.goals.length > 1">
                                    <!-- Add Arrows -->
                                    <div class="swiper-button-next swiper-button-white"></div>
                                    <div class="swiper-button-prev swiper-button-white"></div>
                                </div>
                            </div>
                        </div>
                        <br/>
                    </div>

                    <div class="navigation text-center">
                        <a href="javascript:void(0)"
                           data-ng-cloak
                           data-ng-show="!Activities.busy && Activities.request >= 1"
                           data-ng-click='Activities.getReserve("{{ env_prefix }}/api/v2.0/activities/{first}/{count}")'
                           class="show-more ng-hide">
                            <span></span>
                            <span></span>
                            <span></span>
                        </a>
                    </div>

                </div>

                {% endblock %}

                <div class="col-md-4">
                    {% include 'AppBundle:Blocks:completeProfile.html.twig' with {'user': app.user}  %}
                    {% include 'AppBundle:Blocks:myBucketlist.html.twig' with {'user': app.user} %}
                    {% include 'AppBundle:Blocks:goalfriends.html.twig' with {'user': app.user} %}
                    {%  include "AppBundle:Blocks:featureGoals.html.twig" %}
                    {%  include "AppBundle:Blocks:popularGoals.html.twig" with {'user': app.user, 'count': 2}  %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% macro goal(env_prefix) %}
    <div class="row">
        <div class="col-sm-12 idea-item">
            <figure data-ng-repeat="singleGoal in activity.reserveGoals" class="rounded-corners">
                <i class="icon-lock-white" data-ng-show="!singleGoal.status"></i>

                <a data-ng-href="[[ singleGoal.publish? '{{ env_prefix }}/goal/' + singleGoal.slug : '#' ]]"
                   class="goalTitle">
                    <span class="overlay"></span>
                    <h3>[[ ::singleGoal.title ]]</h3>
                    <img data-ng-if="singleGoal.cached_image" data-ng-src="[[ ::singleGoal.cached_image ]]" alt="[[ ::singleGoal.title ]]"/>

                    <div class="absolute" data-ng-show="singleGoal.stats.listedBy && singleGoal.stats.doneBy">
                        <ul>
                            <li>
                                <a ls-goal-users
                                   href="javascript:void(0)"
                                   ls-goal-id="[[ singleGoal.id ]]"
                                   ls-category="listed"
                                   ls-count="[[ ::singleGoal.stats.listedBy ]]"
                                   class="ng-scope">
                                    <span class="ng-binding">{{ 'home_listed_by'|trans({},'messages') }} [[ ::singleGoal.stats.listedBy ]] </span>
                                    <i class="icon-user-small"></i>
                                </a>
                            </li>
                            <li>
                                <a ls-goal-users
                                   href="javascript:void(0)"
                                   ls-goal-id="[[ singleGoal.id ]]"
                                   ls-count="[[ ::singleGoal.stats.doneBy ]]"
                                   class="ng-scope">
                                    <span class="ng-binding">{{ 'home_complete'|trans({},'messages') }} [[ ::singleGoal.stats.doneBy ]]</span>
                                    <i class="icon-user-small"></i>
                                </a>
                            </li>
                        </ul>
                    </div>

                </a>
                <figcaption>
                    {% include "AppBundle:Blocks:newsFeedGoalFooter.html.twig" %}
                </figcaption>
            </figure>
        </div>
    </div>
{% endmacro %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts output='js/app_activity.js'
    'app/bower_components/swiper/dist/js/swiper.min.js'
    'bundles/app/js/swiper-inner.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{%- block title -%}
    {{ 'activities.title'|trans }}
{%- endblock -%}

{%- block meta_description -%}
    {{ 'activities.description'|trans }}
{%- endblock -%}

{%- block og_url -%}
    {{- app.request.uri -}}
{%- endblock -%}
